{% load static %} 
{% load integration_tags %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}cewko's home{% endblock %}</title>

    <link rel="icon" type="image/x-icon" href="{% static 'pages/images/favicon-small.ico' %}">

    <link rel="stylesheet" href="{% static 'pages/css/base.css' %}" />
    <style>
      .main-container {
        opacity: 0;
        animation: fadeIn 0.6s ease-out forwards;
        animation-delay: 0.1s;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      .credits {
        opacity: 0;
        animation: fadeIn 0.6s ease-out forwards;
        animation-delay: 0.1s;
      }

      .left-column > * {
        opacity: 0;
        animation: fadeIn 0.6s ease-out forwards;
        animation-delay: 0.1s;
      }

      .right-column > * {
        opacity: 0;
        animation: fadeIn 0.6s ease-out forwards;
        animation-delay: 0.1s;
      }

      .bottom-grid {
        opacity: 0;
        animation: fadeIn 0.6s ease-out forwards;
        animation-delay: 0.1s;
      }
  </style>

    
    {% block extra_css %}{% endblock %}

    <script src="{% static 'pages/js/preloader.js' %}"></script>
  </head>
  <body>
    <div class="video-background">
      <video autoplay muted loop playsinline preload="none" id="bg-video" poster="{% static 'pages/images/bg-poster.jpg' %}">
        <source src="{% static 'pages/videos/bg-optimized.webm' %}" type="video/webm">
      </video>
    </div>
    
    <div class="main-container">
      <div class="left-column">{% block left_column %} {% endblock %}</div>

      <div class="right-column">
        {% block right_column %}

        <div class="widget">
          <div class="widget-container">
            <div class="widget-title">NAVBAR</div>
            <div class="widget-bar"></div>
            <div class="widget-links">
              <div class="link-row">
                <a href="{% url 'pages:home' %}" class="widget-link">Home</a>
                {% if current_page == "home" %}<span class="page-status">[~]</span>{% endif %}
              </div>
              <div class="link-row">
                <a href="{% url 'weblog:article_inventory' %}" class="widget-link">WebLog</a>
                {% if current_page == "weblog" %}<span class="page-status">[~]</span>{% endif %}
              </div>
            </div>
          </div>
        </div>

        <div class="widget">
          <div class="widget-container">
            <div class="widget-title">CONTACT</div>
            <div class="widget-bar"></div>
            <div class="widget-links">
              <a href="https://t.me/cewkx" class="widget-link" target="_blank">Telegram</a>
              <a href="https://soundcloud.com/cewko" class="widget-link" target="_blank">Soundcloud</a>
              <div class="link-row">
                <a href="https://discord.gg/wDYe5EjZnN" class="widget-link" target="_blank">Discord</a>
                {% discord_status_widget %}
              </div>
              <a href="https://bsky.app/profile/cewko.me" class="widget-link" target="_blank">Bluesky</a>
              <a href="https://ko-fi.com/cewko" class="widget-link" target="_blank">Support</a> 
            </div>
          </div>
        </div>

        {% block right_column_extra %} {% endblock %} {% endblock %}
      </div>

      {% block bottom_grid %} {% endblock %}
    </div>

    {% block credits %}
    <div class="credits">
      <div class="credits-row">
        <span class="credits-label">background by</span>
        <a
          href="https://motocross-arts.tumblr.com/"
          class="credits-link"
          target="_blank"
          >motocross
        </a>
      </div>
    </div>
    {% endblock %} 

    <script defer>
      function checkCreditsCollision() {
        const credits = document.querySelector(".credits");
        const mainContainer = document.querySelector(".main-container");

        if (!credits || !mainContainer) return;

        const creditsRect = credits.getBoundingClientRect();
        const containerRect = mainContainer.getBoundingClientRect();

        const isColliding = !(
          creditsRect.right < containerRect.left ||
          creditsRect.left > containerRect.right ||
          creditsRect.bottom < containerRect.top ||
          creditsRect.top > containerRect.bottom
        );

        if (isColliding) {
          credits.style.setProperty('opacity', '0', 'important');
          credits.style.pointerEvents = "none";
        } else {
          credits.style.setProperty('opacity', '1', 'important');
          credits.style.pointerEvents = "auto";
        }
      }

      window.addEventListener("load", () => {
        setTimeout(() => {
          checkCreditsCollision();
        }, 800);
      });

      window.addEventListener("resize", checkCreditsCollision);
      window.addEventListener("scroll", checkCreditsCollision);
    </script>

    {% block extra_js %}
    
    {% endblock %}
  </body>
</html>
