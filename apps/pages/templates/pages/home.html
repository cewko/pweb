{% extends "pages/base.html" %}
{% load static %}
{% load cache %}
{% load integration_tags %}
{% load analytics_tags %}
{% load weblog_tags %}
{% load hangout_tags %}


{% block extra_css %}
<link rel="stylesheet" href="{% static 'pages/css/home.css' %}" />
<style>
.widget-drag-handle {
    cursor: grab;
    user-select: none;
}

.widget-drag-handle:active {
    cursor: grabbing;
}

.widget.dragging {
    opacity: 0.5;
}

.widget.drag-over {
    border-color: var(--color-secondary);
    border-width: 5px;
}
/* stats row for wakatime + visitors for debugging */
.stats-row {
  display: grid !important;
  grid-template-columns: 1fr 1fr !important;
  gap: 10px !important;
}

/* WakaTime Stats */
.wakatime-stats {
  display: flex !important;
  flex-direction: column !important;
  justify-content: space-between !important;
  margin-top: -5px;
}

.stat-column {
  display: flex !important;
  flex-direction: column !important;
  gap: 8px !important;
}

.stat-column:last-child {
  padding-top: 5px !important;
}

.stat-label {
  font-family: "Ari-W9500 Display", monospace !important;
  font-size: 20px !important;
  color: var(--color-primary) !important;
  white-space: nowrap !important;
}

.wakatime-digit.non-zero {
  color: var(--color-primary);
}

.stat-value {
  font-family: "Ari-W9500 Display", monospace !important;
  font-size: 16px !important;
  color: var(--color-secondary) !important;
}

/* Visitors Widget */
.visitors-content {
  display: flex !important;
  flex-direction: column !important;
  gap: 5px !important;
  margin-top: -5px;
}

.visitors-row {
  display: flex !important;
  flex-direction: column !important;
  gap: 8px !important;
}

.visitors-label {
  font-family: "Ari-W9500 Display", monospace !important;
  font-size: 20px !important;
  color: var(--color-primary) !important;
}

.visitors-value {
  font-family: "Ari-W9500 Display", monospace !important;
  font-size: 16px !important;
  color: var(--color-secondary) !important;
  text-align: left;
}

.visitor-digit {
  color: var(--color-secondary) !important;
}

.visitor-digit.non-zero {
  color: var(--color-primary) !important;
}

.visitor-dot {
  color: var(--color-secondary) !important;
}
/* Hangout Widget */
.hangout-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.online-count {
  color: var(--color-secondary);
  font-family: "Ari-W9500 Display", monospace;
  font-size: 20px;
}

.chat-messages {
  background: var(--color-background);
  border: 3px solid var(--color-secondary);
  padding: 10px;
  height: 182px;
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.chat-message {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.message-content {
  display: block;
  line-height: 1.4;
}

.message-time {
  font-family: "Ari-W9500 Display", sans-serif;
  font-size: 12px;
  color: var(--color-secondary);
}

.message-author {
  font-family: "Ari-W9500 Display", sans-serif;
  font-size: 16px;
  color: var(--color-primary);
  display: inline;
}

.message-text {
  font-family: "Ari-W9500 Display", monospace;
  font-size: 16px;
  color: var(--color-primary);
  line-height: 1.4;
  margin-left: 0px;
  display: inline;
}

.chat-input-container {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.chat-input {
  background: var(--color-background);
  border: 3px solid var(--color-secondary);
  padding: 10px;
  font-family: "Ari-W9500 Display", monospace;
  font-size: 16px;
  color: var(--color-primary);
  resize: none;
}

.chat-input::placeholder {
  color: var(--color-secondary);
}

.chat-input:focus {
  outline: none;
  border-color: var(--color-primary);
}

.chat-bottom {
  display: flex;
  gap: 10px;
}

.nickname-input {
  background: var(--color-background);
  border: 3px solid var(--color-secondary);
  padding: 10px;
  font-family: "Ari-W9500 Display", monospace;
  font-size: 16px;
  color: var(--color-primary);
  flex: 1;
}

.nickname-input::placeholder {
  color: var(--color-secondary);
}

.nickname-input:focus {
  outline: none;
  border-color: var(--color-primary);
}

.send-button {
  background: var(--color-background);
  border: 3px solid var(--color-secondary);
  padding: 10px;
  font-family: "Ari-W9500 Display", sans-serif;
  font-size: 16px;
  color: var(--color-secondary);
  cursor: pointer;
  transition: all 0.2s;
}

.send-button:hover {
  background: var(--color-primary);
  color: var(--color-background);
}

.send-button:active {
  transform: translateY(2px);
}

/* Craft Widget */
.craft-projects {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: -5px;
}

.project-item {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.project-link {
  text-decoration: none;
}

.project-description {
  font-family: "Ari-W9500 Display", monospace;
  font-size: 16px;
  line-height: 1.4;
  color: var(--color-primary);
}

.project-link:hover .project-description {
  color: var(--color-secondary);
}

.project-tech {
  color: var(--color-secondary) !important;
}

.weather-widget {
  flex: 1;
  position: relative;
}

.weather-tooltip {
  position: absolute;
  background: var(--color-primary);
  color: var(--color-background);
  padding: 8px 12px;
  border-radius: 4px;
  font-family: "Ari-W9500 Display", monospace;
  font-size: 12px;
  pointer-events: none;
  opacity: 0;
  transition: opacity 0.2s;
  z-index: 100;
  white-space: nowrap;
}

.weather-tooltip.show {
  opacity: 1;
}

.weather-stat {
  cursor: pointer;
}

.info-label {
  background: var(--color-secondary);
  color: var(--color-background);
  font-family: "Retro Pixel Arcade";
  font-size: 1.3rem;
  padding: 7px 10px;
  min-width: 6.5rem;
  line-height: 1;
}

.info-value {
  color: var(--color-primary);
  font-family: "Ari-W9500 Display", sans-serif;
  font-size: 1.4rem;
  line-height: 1;
  letter-spacing: 1px;
}

</style>
{% endblock %} 

{% block left_column %}
<!-- Profile Widget -->
<div class="profile-widget">
  <div class="profile-content">
    <div class="header-section">
      <div class="widget-title">VALUABLE INFORMATION</div>
      <div class="header-line"></div>
    </div>

    <div class="main-section">
      <div class="profile-image empty-frame">
      </div>

      <div class="info-section">
        <div class="info-rows">
          <div class="info-group">
            <div class="info-row">
              <div class="info-label">DOB.</div>
              <div class="info-value">Dec. 11</div>
            </div>
            <div class="info-row">
              <div class="info-label">ISS.</div>
              <div class="info-value">Poland</div>
            </div>
            <div class="info-row">
              <div class="info-label">OBS.</div>
              <div class="info-value">Backend Development</div>
            </div>
            <div class="info-row">
              <div class="info-label">HBS.</div>
              <div class="info-value">CompMC + languages</div>
            </div>
            <div class="info-row">
              <div class="info-label">HBS.</div>
              <div class="info-value">Psychological Novels</div>
            </div>
          </div>
        </div>

        <div class="signature-section">
          {% comment %} <div class="signature">CEWKO</div> {% endcomment %}
          <div class="signature-line"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="footer-section">
    <div class="widget-title">C3VK0-X9N4D-Q8GKV</div>
  </div>
</div>

<!-- Recent Widgets Row -->
<div class="recent-widgets-row">
  <!-- Recent Status Widget -->
  <div class="recent-widget">
    <div class="widget-container">
      <div class="widget-title">
        <a href="https://bsky.app/profile/cewko.me" class="widget-title-link" target="_blank">
          <span class="widget-title-text">SHOWER THOUGHT</span>
        </a>
      </div>
      <div class="widget-bar"></div>
      <div class="recent-content">{% bluesky_widget %}</div>
    </div>
  </div>

  <!-- Recent Song Widget -->
  <div class="recent-widget">
    <div class="widget-container">
      <div class="widget-title">
        <a href="https://www.last.fm/user/cewko" class="widget-title-link" target="_blank">
          <span class="widget-title-text">ONGOING STREAM</span>
        </a>
      </div>
      <div class="widget-bar"></div>
      <div class="recent-content">{% lastfm_widget %}</div>
    </div>
  </div>
</div>

{% endblock %}

{% block right_column_extra %}
<div class="widget weather-widget">
    <div class="widget-container">
        <div class="widget-title">
            <a href="https://open-meteo.com/" class="widget-title-link" target="_blank">
                <span class="widget-title-text">WEATHER</span>
            </a>
        </div>
        <div class="widget-bar"></div>
        {% weather_widget %}
    </div>
</div>
{% endblock %}

{% block bottom_grid %}
<div class="bottom-grid">
    <div class="left-bottom-column">
        {% cache 1800 github_widget %}
        <!-- Contributions Widget -->
        <div class="widget">
            <div class="widget-container">
                <div class="widget-drag-handle">
                  <div class="widget-title">
                      <a href="https://github.com/cewko" class="widget-title-link" target="_blank">
                          <span class="widget-title-text">CONTRIBUTIONS</span>
                      </a>
                  </div>
                </div>
                <div class="widget-bar"></div>
                {% github_widget %}
            </div>
        </div>
        {% endcache %}
        <!-- Hangout Widget -->
        <div class="widget">
            <div class="widget-container">
                {% hangout_widget %}
            </div>
        </div>
    </div>
    <div class="right-bottom-column">
        {% cache 300 weblog_widget %}
        <!-- Weblog Widget -->
        <div class="widget">
            <div class="widget-container">
                <div class="widget-drag-handle">
                  <div class="weblog-header">
                      <div class="widget-title">
                          <a href="{% url 'weblog:article_inventory' %}" class="widget-title-link">
                              <span class="widget-title-text">WEBLOG</span>
                          </a>
                      </div>
                      <div class="weblog-rss">
                          <a href="{% url 'weblog:rss_feed' %}" class="widget-title-link">
                              <span class="bracket-up">[</span><span class="widget-title-text">RSS</span><span class="bracket-up">]</span>
                          </a>
                      </div>
                  </div>
                </div>
                <div class="widget-bar"></div>
                {% recent_articles_widget limit=3 %}
            </div>
        </div>
        {% endcache %}
        
        <!-- Craft Widget -->
        <div class="widget">
            <div class="widget-container">
                <div class="widget-drag-handle">
                  <div class="widget-title">
                      <a href="https://github.com/cewko" class="widget-title-link" target="_blank">
                          <span class="widget-title-text">CRAFT</span>
                      </a>
                  </div>
                </div>
                <div class="widget-bar"></div>
                  <div class="craft-projects">
                      <div class="project-item">
                          <a href="https://github.com/cewko/color-picker" class="project-link" target="_blank">
                              <div class="project-description">Select color. copy to clipboard and get desktop notification 
                                  <span class="project-tech">[ bash : gpick : xclip : libnotify ]</span>
                              </div>
                          </a>
                      </div> 
                      <div class="project-item">
                          <a href="https://github.com/cewko/meep" class="project-link" target="_blank">
                              <div class="project-description">Enable voice communication for Minecraft using Faster-Whisper 
                                  <span class="project-tech">[ python : CTk ]</span>
                              </div>
                          </a>
                      </div>
                      <div class="project-item">
                          <a href="https://github.com/cewko/file-organizer" class="project-link" target="_blank">
                              <div class="project-description">Organize files by moving them into categorized folders based on their extensions
                                  <span class="project-tech">[ bash ]</span>
                              </div>
                          </a>
                      </div>   
                  </div>
            </div>
        </div>
        
        <!-- Stats Row: WakaTime + Visitors -->
        <div class="stats-row">
            <!-- WakaTime Widget -->
            <div class="widget">
                <div class="widget-container">
                  <div class="widget-drag-handle">
                    <div class="widget-title">
                        <a href="https://wakatime.com/@cewko" class="widget-title-link" target="_blank">
                            <span class="widget-title-text">WAKATIME</span>
                        </a>
                    </div>
                  </div>
                    <div class="widget-bar"></div>
                    {% wakatime_widget %}
                </div>
            </div>

            <!-- Visitors Widget -->
            <div class="widget">
                <div class="widget-container">
                  <div class="widget-drag-handle">
                    <div class="widget-title">VISITORS</div>
                  </div>
                    <div class="widget-bar"></div>
                    {% visitors_widget %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'pages/js/components/clock.js' %}" defer></script>
<script src="{% static 'pages/js/components/tooltip.js' %}" defer></script>
<script src="{% static 'pages/js/components/dragDrop.js' %}" defer></script>

<script defer>
(function() {
  const weatherStats = document.querySelectorAll('.weather-stat');
  const tooltip = document.getElementById('weather-tooltip');
  
  if (!tooltip) return;
  
  weatherStats.forEach(stat => {
    stat.addEventListener('mouseenter', (e) => {
      const description = stat.getAttribute('data-description');
      tooltip.textContent = description;
      tooltip.classList.add('show');
      
      const rect = stat.getBoundingClientRect();
      const container = stat.closest('.weather-widget');
      const containerRect = container.getBoundingClientRect();
      
      tooltip.style.left = (rect.left - containerRect.left + rect.width / 2) + 'px';
      tooltip.style.top = (rect.top - containerRect.top - 35) + 'px';
      tooltip.style.transform = 'translateX(-50%)';
    });
    
    stat.addEventListener('mouseleave', () => {
      tooltip.classList.remove('show');
    });
  });
})();
</script>

<script defer>
document.addEventListener('DOMContentLoaded', () => {
  initRecentTooltips();
  initClock();
  initDragAndDrop();
});
</script>

<script defer>
function matchProfileHeight() {
  const profile = document.querySelector('.profile-widget');
  const rightColumn = document.querySelector('.right-column');
  
  if (!profile || !rightColumn) return;
  
  const widgets = Array.from(rightColumn.querySelectorAll('.widget'));
  const weatherWidget = document.querySelector('.weather-widget');
  const weatherIndex = widgets.indexOf(weatherWidget);
  
  const topWidgets = widgets.slice(0, weatherIndex);
  
  let totalHeight = 0;
  topWidgets.forEach((widget, index) => {
    totalHeight += widget.offsetHeight;
    if (index < topWidgets.length - 1) {
      totalHeight += 10;
    }
  });
  
  profile.style.height = totalHeight + 'px'
}

window.addEventListener('load', matchProfileHeight);
window.addEventListener('resize', matchProfileHeight);
</script>
{% endblock %}